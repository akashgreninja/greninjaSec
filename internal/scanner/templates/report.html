<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreninjaSec Security Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü•∑ GreninjaSec Security Report</h1>
            <div class="timestamp">Generated: {{.Timestamp}}</div>
        </div>

        <div class="stats-grid">
            <div class="stat-card critical">
                <div class="stat-number">{{.CriticalCount}}</div>
                <div class="stat-label">Critical</div>
            </div>
            <div class="stat-card high">
                <div class="stat-number">{{.HighCount}}</div>
                <div class="stat-label">High</div>
            </div>
            <div class="stat-card medium">
                <div class="stat-number">{{.MediumCount}}</div>
                <div class="stat-label">Medium</div>
            </div>
            <div class="stat-card low">
                <div class="stat-number">{{.LowCount}}</div>
                <div class="stat-label">Low</div>
            </div>
            <div class="stat-card total">
                <div class="stat-number">{{.TotalFindings}}</div>
                <div class="stat-label">Total</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'overview')">üìä Overview</button>
            {{if .CVEFindings}}<button class="tab-button" onclick="openTab(event, 'cve')">üîç CVE ({{.CVECount}})</button>{{end}}
            {{if .AttackChains}}<button class="tab-button" onclick="openTab(event, 'attack-chains')">üéØ Attack Chains ({{len .AttackChains}})</button>{{end}}
            <button class="tab-button" onclick="openTab(event, 'kubernetes')">‚ò∏Ô∏è Kubernetes</button>
            <button class="tab-button" onclick="openTab(event, 'terraform')">üèóÔ∏è Terraform</button>
            <button class="tab-button" onclick="openTab(event, 'docker')">üê≥ Docker</button>
            <button class="tab-button" onclick="openTab(event, 'secrets')">üîê Secrets</button>
            <button class="tab-button" onclick="openTab(event, 'all-findings')">üìã All Findings</button>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="summary-box">
                <h3>üìä Scan Summary</h3>
                <p>{{.ScanSummary}}</p>
            </div>

            <!-- Quick Stats Grid -->
            <div class="quick-stats">
                {{if .CVEFindings}}
                <div class="quick-stat-card cve">
                    <div class="quick-stat-icon">üîç</div>
                    <div class="quick-stat-number">{{.CVECount}}</div>
                    <div class="quick-stat-label">CVE Vulnerabilities</div>
                </div>
                {{end}}
                {{if .AttackChains}}
                <div class="quick-stat-card chains">
                    <div class="quick-stat-icon">üéØ</div>
                    <div class="quick-stat-number">{{len .AttackChains}}</div>
                    <div class="quick-stat-label">Attack Chains</div>
                </div>
                {{end}}
                <div class="quick-stat-card scanners">
                    <div class="quick-stat-icon">üîß</div>
                    <div class="quick-stat-number">5</div>
                    <div class="quick-stat-label">Scanners Used</div>
                </div>
            </div>

            <!-- Top Issues Preview -->
            {{if index .FindingsBySev "CRITICAL"}}
            <div class="section">
                <h2 class="section-title">ÔøΩ Top Critical Issues</h2>
                <div class="preview-findings">
                    {{range $idx, $finding := index $.FindingsBySev "CRITICAL"}}
                    {{if lt $idx 5}}
                    <div class="preview-finding critical">
                        <div class="preview-icon">üî¥</div>
                        <div class="preview-content">
                            <div class="preview-title">{{$finding.Title}}</div>
                            <div class="preview-file">üìÑ {{$finding.File}}</div>
                        </div>
                        <span class="severity-badge severity-critical">CRITICAL</span>
                    </div>
                    {{end}}
                    {{end}}
                    {{if gt (len (index $.FindingsBySev "CRITICAL")) 5}}
                    <div class="preview-more">
                        <a href="#" onclick="openTab(event, 'all-findings'); return false;">
                            + {{sub (len (index $.FindingsBySev "CRITICAL")) 5}} more critical issues
                        </a>
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}

            <!-- Attack Chains Preview -->
            {{if .AttackChains}}
            <div class="section">
                <h2 class="section-title">‚ö° Attack Chains Preview</h2>
                <div class="preview-chains">
                    {{range $idx, $chain := .AttackChains}}
                    {{if lt $idx 3}}
                    <div class="preview-chain">
                        <div class="preview-chain-header">
                            <span class="chain-icon">üíÄ</span>
                            <span class="chain-name">{{$chain.Name}}</span>
                            <span class="risk-badge risk-{{lower $chain.Severity}}">{{$chain.Severity}}</span>
                        </div>
                        <div class="preview-chain-stats">
                            <span>üìç {{len $chain.Steps}} steps</span>
                            <span>‚ö†Ô∏è {{len $chain.Findings}} vulnerabilities</span>
                            <span>üé≤ {{$chain.Likelihood}} likelihood</span>
                        </div>
                    </div>
                    {{end}}
                    {{end}}
                    {{if gt (len .AttackChains) 3}}
                    <div class="preview-more">
                        <a href="#" onclick="openTab(event, 'attack-chains'); return false;">
                            View all {{len .AttackChains}} attack chains ‚Üí
                        </a>
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            <div class="section">
                <h2 class="section-title">ÔøΩüìà Security Metrics</h2>
                <div class="charts-grid">
                    <div class="chart-container">
                        <canvas id="severityChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="fileChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recommendations Box -->
            <div class="recommendations-box">
                <h3>üéØ Recommended Actions</h3>
                <div class="recommendations-list">
                    {{if gt .CriticalCount 0}}
                    <div class="recommendation critical">
                        <span class="rec-icon">üî¥</span>
                        <span class="rec-text">Address <strong>{{.CriticalCount}} critical vulnerabilities</strong> immediately</span>
                    </div>
                    {{end}}
                    {{if gt .HighCount 0}}
                    <div class="recommendation high">
                        <span class="rec-icon">üü†</span>
                        <span class="rec-text">Review <strong>{{.HighCount}} high severity issues</strong> this sprint</span>
                    </div>
                    {{end}}
                    {{if .AttackChains}}
                    <div class="recommendation chain">
                        <span class="rec-icon">üéØ</span>
                        <span class="rec-text">Analyze <strong>{{len .AttackChains}} attack chains</strong> to understand exploit paths</span>
                    </div>
                    {{end}}
                    {{if .CVEFindings}}
                    <div class="recommendation cve">
                        <span class="rec-icon">üîç</span>
                        <span class="rec-text">Update dependencies to fix <strong>{{.CVECount}} CVE vulnerabilities</strong></span>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>

        <!-- CVE Tab -->
        {{if .CVEFindings}}
        <div id="cve" class="tab-content">
            <h2 class="section-title">üîç CVE Vulnerabilities</h2>
            <div class="cve-grid">
                {{range $idx, $finding := .CVEFindings}}
                {{if lt $idx 10}}
                <div class="cve-card severity-{{lower $finding.Severity}}">
                    <div class="cve-header">
                        <span class="cve-id">{{$finding.RuleID}}</span>
                        <span class="severity-badge severity-{{lower $finding.Severity}}">{{$finding.Severity}}</span>
                    </div>
                    <div class="cve-title">{{$finding.Title}}</div>
                    <div class="cve-file">üìÑ {{$finding.File}}</div>
                    {{if $finding.Snippet}}
                    <div class="cve-snippet">{{$finding.Snippet}}</div>
                    {{end}}
                </div>
                {{end}}
                {{end}}
            </div>
            {{if gt (len .CVEFindings) 10}}
            <div class="cve-more">
                <p>... and {{sub (len .CVEFindings) 10}} more CVE vulnerabilities. See "All Findings" tab for complete list.</p>
            </div>
            {{end}}
        </div>
        {{end}}

        <!-- Attack Chains Tab -->
        {{if .AttackChains}}
        <div id="attack-chains" class="tab-content">
            <h2 class="section-title">üéØ Attack Chain Analysis</h2>
            {{range $chain := .AttackChains}}
            <div class="chain-container">
                <div class="chain-header">
                    <div>
                        <h3>{{$chain.Name}}</h3>
                        <p>{{len $chain.Findings}} vulnerabilities exploited across {{len $chain.Steps}} steps</p>
                    </div>
                    <span class="risk-badge risk-{{lower $chain.Severity}}">{{$chain.Severity}} RISK</span>
                </div>
                <div class="chain-steps">
                    {{range $idx, $step := $chain.Steps}}
                    <div class="chain-step">
                        <div class="step-number">{{$step.Step}}</div>
                        <div class="step-content">
                            <p>{{$step.Description}}</p>
                        </div>
                    </div>
                    {{end}}
                </div>
                <div class="chain-impact">
                    <strong>üí• Potential Impact:</strong> {{$chain.Impact}}
                </div>
            </div>
            {{end}}
        </div>
        {{end}}

        <!-- Kubernetes Tab -->
        <div id="kubernetes" class="tab-content">
            <h2 class="section-title">‚ò∏Ô∏è Kubernetes Security Findings</h2>
            {{range $sev := list "CRITICAL" "HIGH" "MEDIUM" "LOW"}}
                {{$findings := index $.FindingsBySev $sev}}
                {{if $findings}}
                    {{$hasK8s := false}}
                    {{range $finding := $findings}}
                        {{if or (eq $finding.RuleID "R001") (hasPrefix $finding.RuleID "KUBESEC_")}}
                            {{if not $hasK8s}}
                                <h3 style="color: {{colorForSeverity $sev}}; margin: 2rem 0 1rem 0;">{{$sev}} ({{len $findings}})</h3>
                                {{$hasK8s = true}}
                            {{end}}
                            <div class="finding">
                                <div class="finding-header">
                                    <div>
                                        <div class="finding-title">{{$finding.Title}}</div>
                                        <div class="finding-file">üìÑ {{$finding.File}}</div>
                                    </div>
                                    <span class="badge {{lower $finding.Severity}}">{{$finding.Severity}}</span>
                                </div>
                                {{if $finding.Snippet}}
                                <div class="code-snippet">{{$finding.Snippet}}</div>
                                {{end}}
                            </div>
                        {{end}}
                    {{end}}
                {{end}}
            {{end}}
        </div>

        <!-- Terraform Tab -->
        <div id="terraform" class="tab-content">
            <h2 class="section-title">üèóÔ∏è Terraform Security Findings</h2>
            {{range $sev := list "CRITICAL" "HIGH" "MEDIUM" "LOW"}}
                {{$findings := index $.FindingsBySev $sev}}
                {{if $findings}}
                    {{$hasTF := false}}
                    {{range $finding := $findings}}
                        {{if hasPrefix $finding.RuleID "TFSEC_"}}
                            {{if not $hasTF}}
                                <h3 style="color: {{colorForSeverity $sev}}; margin: 2rem 0 1rem 0;">{{$sev}}</h3>
                                {{$hasTF = true}}
                            {{end}}
                            <div class="finding">
                                <div class="finding-header">
                                    <div>
                                        <div class="finding-title">{{$finding.Title}}</div>
                                        <div class="finding-file">üìÑ {{$finding.File}}</div>
                                    </div>
                                    <span class="badge {{lower $finding.Severity}}">{{$finding.Severity}}</span>
                                </div>
                                {{if $finding.Snippet}}
                                <div class="code-snippet">{{$finding.Snippet}}</div>
                                {{end}}
                            </div>
                        {{end}}
                    {{end}}
                {{end}}
            {{end}}
        </div>

        <!-- Docker Tab -->
        <div id="docker" class="tab-content">
            <h2 class="section-title">üê≥ Docker/Hadolint Findings</h2>
            {{range $sev := list "CRITICAL" "HIGH" "MEDIUM" "LOW"}}
                {{$findings := index $.FindingsBySev $sev}}
                {{if $findings}}
                    {{$hasDocker := false}}
                    {{range $finding := $findings}}
                        {{if hasPrefix $finding.RuleID "HADOLINT_"}}
                            {{if not $hasDocker}}
                                <h3 style="color: {{colorForSeverity $sev}}; margin: 2rem 0 1rem 0;">{{$sev}}</h3>
                                {{$hasDocker = true}}
                            {{end}}
                            <div class="finding">
                                <div class="finding-header">
                                    <div>
                                        <div class="finding-title">{{$finding.Title}}</div>
                                        <div class="finding-file">üìÑ {{$finding.File}}</div>
                                    </div>
                                    <span class="badge {{lower $finding.Severity}}">{{$finding.Severity}}</span>
                                </div>
                                {{if $finding.Snippet}}
                                <div class="code-snippet">{{$finding.Snippet}}</div>
                                {{end}}
                            </div>
                        {{end}}
                    {{end}}
                {{end}}
            {{end}}
        </div>

        <!-- Secrets Tab -->
        <div id="secrets" class="tab-content">
            <h2 class="section-title">üîê Hardcoded Secrets</h2>
            {{range $sev := list "CRITICAL" "HIGH" "MEDIUM" "LOW"}}
                {{$findings := index $.FindingsBySev $sev}}
                {{if $findings}}
                    {{$hasSecrets := false}}
                    {{range $finding := $findings}}
                        {{if hasPrefix $finding.RuleID "SECRET_"}}
                            {{if not $hasSecrets}}
                                <h3 style="color: {{colorForSeverity $sev}}; margin: 2rem 0 1rem 0;">{{$sev}}</h3>
                                {{$hasSecrets = true}}
                            {{end}}
                            <div class="finding">
                                <div class="finding-header">
                                    <div>
                                        <div class="finding-title">{{$finding.Title}}</div>
                                        <div class="finding-file">üìÑ {{$finding.File}}</div>
                                    </div>
                                    <span class="badge {{lower $finding.Severity}}">{{$finding.Severity}}</span>
                                </div>
                                {{if $finding.Snippet}}
                                <div class="code-snippet">{{$finding.Snippet}}</div>
                                {{end}}
                            </div>
                        {{end}}
                    {{end}}
                {{end}}
            {{end}}
        </div>

        <!-- All Findings Tab -->
        <div id="all-findings" class="tab-content">
            <h2 class="section-title">üìã All Findings by Severity</h2>
            {{range $severity := list "CRITICAL" "HIGH" "MEDIUM" "LOW"}}
                {{if index $.FindingsBySev $severity}}
                <h3 style="color: {{colorForSeverity $severity}}; margin: 2rem 0 1rem 0;">{{$severity}} ({{len (index $.FindingsBySev $severity)}})</h3>
                {{range index $.FindingsBySev $severity}}
                <div class="finding">
                    <div class="finding-header">
                        <div>
                            <div class="finding-title">{{.Title}}</div>
                            <div class="finding-file">üìÑ {{.File}}</div>
                        </div>
                        <span class="badge {{.Severity | lower}}">{{.Severity}}</span>
                    </div>
                    {{if .Snippet}}
                    <div class="code-snippet">{{.Snippet}}</div>
                    {{end}}
                    {{if .AIRemediation}}
                    <div class="ai-remediation">
                        <div class="ai-header">
                            <h4>ü§ñ AI-Powered Remediation</h4>
                            <span class="confidence-score">Confidence: {{printf "%.0f" .AIRemediation.ConfidenceScore}}%</span>
                        </div>
                        <div class="ai-content">
                            <div class="ai-section">
                                <h5>üìã Summary</h5>
                                <p>{{.AIRemediation.Summary}}</p>
                            </div>
                            <div class="ai-section">
                                <h5>üîç Risk Analysis</h5>
                                <p>{{.AIRemediation.RiskAnalysis}}</p>
                            </div>
                            {{if .AIRemediation.CodePatch}}
                            <div class="ai-section">
                                <h5>üîß Code Patch</h5>
                                <pre class="code-patch">{{.AIRemediation.CodePatch}}</pre>
                            </div>
                            {{end}}
                            {{if .AIRemediation.Commands}}
                            <div class="ai-section">
                                <h5>üíª Commands</h5>
                                <ul class="command-list">
                                {{range .AIRemediation.Commands}}
                                <li><code>{{.}}</code></li>
                                {{end}}
                                </ul>
                            </div>
                            {{end}}
                            {{if .AIRemediation.ManualSteps}}
                            <div class="ai-section">
                                <h5>‚úã Manual Steps</h5>
                                <ol class="manual-steps">
                                {{range .AIRemediation.ManualSteps}}
                                <li>{{.}}</li>
                                {{end}}
                                </ol>
                            </div>
                            {{end}}
                            {{if .AIRemediation.AlternateFix}}
                            <div class="ai-section">
                                <h5>üîÑ Alternative Solution</h5>
                                <p>{{.AIRemediation.AlternateFix}}</p>
                            </div>
                            {{end}}
                            {{if .AIRemediation.TestingSteps}}
                            <div class="ai-section">
                                <h5>üß™ Testing Steps</h5>
                                <ol class="testing-steps">
                                {{range .AIRemediation.TestingSteps}}
                                <li>{{.}}</li>
                                {{end}}
                                </ol>
                            </div>
                            {{end}}
                            {{if .AIRemediation.References}}
                            <div class="ai-section">
                                <h5>üìö References</h5>
                                <ul class="references">
                                {{range .AIRemediation.References}}
                                <li><a href="{{.}}" target="_blank">{{.}}</a></li>
                                {{end}}
                                </ul>
                            </div>
                            {{end}}
                        </div>
                    </div>
                    {{end}}
                </div>
                {{end}}
                {{end}}
            {{end}}
        </div>
    </div>

    <script src="./script.js"></script>
</body>
</html>
